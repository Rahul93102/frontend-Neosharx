<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Neo Stories - NeoSharX</title>
    <link href="./dist/output.css" rel="stylesheet" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Newsreader:wght@400;500;700;800&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Newsreader", serif;
      }
      .story-card:hover {
        transform: translateY(-5px);
        transition: all 0.3s ease;
      }
    </style>
  </head>
  <body class="bg-gray-50" data-page="neo">
    <!-- Navigation -->
    <div id="nav-placeholder"></div>

    <!-- Hero Section -->
    <div
      class="bg-gradient-to-r from-purple-600 to-indigo-600 text-white py-16"
    >
      <div class="max-w-7xl mx-auto px-4 text-center">
        <h1 class="text-5xl font-bold mb-4">ðŸ“– Neo Stories</h1>
        <p class="text-xl opacity-90">
          Inspiring tales of innovation and technology
        </p>
      </div>
    </div>

    <!-- Loading State -->
    <div id="loadingState" class="max-w-7xl mx-auto px-4 text-center py-12">
      <i class="fas fa-spinner fa-spin text-4xl text-blue-600"></i>
      <p class="mt-4 text-gray-600">Loading stories...</p>
    </div>

    <!-- Error State -->
    <div
      id="errorState"
      class="hidden max-w-7xl mx-auto px-4 text-center py-12"
    >
      <i class="fas fa-exclamation-circle text-4xl text-red-600"></i>
      <p class="mt-4 text-gray-600">
        Failed to load stories. Please try again.
      </p>
      <button
        onclick="location.reload()"
        class="mt-4 bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700"
      >
        Retry
      </button>
    </div>

    <!-- Featured Story -->
    <div id="featuredStory" class="hidden max-w-7xl mx-auto px-4 py-12">
      <!-- Featured story will be inserted here -->
    </div>

    <!-- Stories Grid -->
    <div id="storiesContainer" class="hidden max-w-7xl mx-auto px-4 pb-16">
      <h2 class="text-3xl font-bold text-gray-800 mb-8">All Neo Stories</h2>
      <div
        id="storiesGrid"
        class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8"
      >
        <!-- Stories will be loaded here -->
      </div>
    </div>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white py-8 mt-16">
      <div class="max-w-7xl mx-auto px-4 text-center">
        <p>&copy; 2025 NeoSharX. All rights reserved.</p>
      </div>
    </footer>

    <script>
      const API_BASE_URL = "http://127.0.0.1:8000/api/auth";
      let allStories = [];

      // Fetch neo stories
      async function fetchNeoStories() {
        try {
          const response = await fetch(`${API_BASE_URL}/neo-stories/`);
          if (!response.ok) throw new Error("Failed to fetch stories");

          allStories = await response.json();

          document.getElementById("loadingState").classList.add("hidden");

          if (allStories.length === 0) {
            document.getElementById("storiesContainer").innerHTML =
              '<div class="text-center py-12 text-gray-600">No stories available yet</div>';
            document
              .getElementById("storiesContainer")
              .classList.remove("hidden");
            return;
          }

          displayFeaturedStory();
          displayStories();
        } catch (error) {
          console.error("Error fetching stories:", error);
          document.getElementById("loadingState").classList.add("hidden");
          document.getElementById("errorState").classList.remove("hidden");
        }
      }

      // Display featured story
      function displayFeaturedStory() {
        const featured = allStories.find((s) => s.is_featured);
        if (!featured) return;

        const container = document.getElementById("featuredStory");
        container.innerHTML = `
            <div class="bg-white rounded-xl shadow-2xl overflow-hidden">
                <div class="md:flex">
                    <div class="md:w-1/2">
                        <img src="${
                          featured.main_image ||
                          "https://via.placeholder.com/800x600?text=Featured+Story"
                        }" 
                             alt="${featured.heading}" 
                             class="w-full h-full object-cover">
                    </div>
                    <div class="md:w-1/2 p-8">
                        <span class="inline-block bg-purple-100 text-purple-800 text-xs font-bold px-3 py-1 rounded-full mb-4">
                            <i class="fas fa-star mr-1"></i> FEATURED
                        </span>
                        <h2 class="text-3xl font-bold text-gray-900 mb-4">${
                          featured.heading
                        }</h2>
                        ${
                          featured.subheading
                            ? `<p class="text-xl text-gray-600 mb-4">${featured.subheading}</p>`
                            : ""
                        }
                        <p class="text-gray-700 mb-6">${
                          featured.introduction || ""
                        }</p>
                        <div class="flex items-center gap-4 mb-6 text-sm text-gray-600">
                            <span><i class="far fa-calendar mr-1"></i>${formatDate(
                              featured.published_at
                            )}</span>
                        </div>
                        <a href="neo-detail.html?slug=${featured.slug}" 
                           class="inline-block bg-purple-600 text-white px-8 py-3 rounded-lg hover:bg-purple-700 transition font-bold">
                            Read Full Story <i class="fas fa-arrow-right ml-2"></i>
                        </a>
                    </div>
                </div>
            </div>
        `;
        container.classList.remove("hidden");
      }

      // Display all stories
      function displayStories() {
        const grid = document.getElementById("storiesGrid");
        const nonFeatured = allStories.filter((s) => !s.is_featured);

        grid.innerHTML = nonFeatured
          .map(
            (story) => `
            <div class="story-card bg-white rounded-xl shadow-lg overflow-hidden cursor-pointer hover:shadow-2xl transition-all"
                 onclick="window.location.href='neo-detail.html?slug=${
                   story.slug
                 }'">
                <div class="relative">
                    <img src="${
                      story.main_image ||
                      "https://via.placeholder.com/400x300?text=Neo+Story"
                    }" 
                         alt="${story.heading}" 
                         class="w-full h-48 object-cover">
                    ${
                      story.category
                        ? `
                        <span class="absolute top-3 left-3 bg-purple-600 text-white text-xs font-bold px-3 py-1 rounded-full">
                            ${story.category}
                        </span>
                    `
                        : ""
                    }
                </div>
                
                <div class="p-6">
                    <h3 class="text-xl font-bold text-gray-900 mb-2 line-clamp-2">${
                      story.heading
                    }</h3>
                    ${
                      story.subheading
                        ? `<p class="text-gray-600 text-sm mb-4 line-clamp-2">${story.subheading}</p>`
                        : ""
                    }
                    
                    <div class="flex items-center justify-between text-sm text-gray-500 mb-4">
                        <span><i class="far fa-calendar mr-1"></i>${formatDate(
                          story.published_at
                        )}</span>
                    </div>
                    
                    <button class="w-full bg-purple-600 text-white py-2 rounded-lg hover:bg-purple-700 transition font-semibold">
                        Read More <i class="fas fa-arrow-right ml-2"></i>
                    </button>
                </div>
            </div>
        `
          )
          .join("");

        document.getElementById("storiesContainer").classList.remove("hidden");
      }

      // Format date
      function formatDate(dateString) {
        const date = new Date(dateString);
        return date.toLocaleDateString("en-US", {
          year: "numeric",
          month: "long",
          day: "numeric",
        });
      }

      // Format number
      function formatNumber(num) {
        if (num >= 1000000) return (num / 1000000).toFixed(1) + "M";
        if (num >= 1000) return (num / 1000).toFixed(1) + "K";
        return num.toString();
      }

      // Initialize on page load
      document.addEventListener("DOMContentLoaded", () => {
        fetchNeoStories();
      });
    </script>

    <!-- Load Navigation -->
    <script src="nav-loader.js"></script>
  </body>
</html>
