<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Talk Episode - NeoSharX</title>
    <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin="" />
    <link
      href="https://fonts.googleapis.com/css2?family=Newsreader:wght@400;500;700;800&display=swap"
      rel="stylesheet"
    />
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <script>
      tailwind.config = {
        darkMode: "class",
        theme: {
          extend: {
            colors: {
              primary: "#067ff9",
              "background-light": "#f5f7f8",
              "background-dark": "#0f1923",
              "content-light": "#111418",
              "content-dark": "#f5f7f8",
              "subtle-light": "#5f758c",
              "subtle-dark": "#a0aec0",
            },
            fontFamily: {
              display: ["Newsreader"],
            },
          },
        },
      };
    </script>
    <link
      href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined"
      rel="stylesheet"
    />
    <style>
      .prose {
        color: #111418;
        max-width: 65ch;
      }
      .dark .prose {
        color: #f5f7f8;
      }
      .prose h2 {
        font-size: 2rem;
        font-weight: 800;
        margin-top: 2.5rem;
        margin-bottom: 1.5rem;
        line-height: 1.3;
      }
      .prose p {
        margin-bottom: 1.5rem;
        line-height: 1.75;
        font-size: 1.125rem;
      }
      .video-container {
        position: relative;
        padding-bottom: 56.25%;
        height: 0;
        overflow: hidden;
        max-width: 100%;
        background: #000;
        border-radius: 0.75rem;
      }
      .video-container iframe {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
      }
    </style>
  </head>
  <body
    class="bg-background-light dark:bg-background-dark font-display text-content-light dark:text-content-dark"
    data-page="talks-detail"
  >
    <div class="relative flex flex-col min-h-screen w-full">
      <div id="nav-container"></div>

      <!-- Main Content -->
      <main class="flex-grow container mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- Loading State -->
        <div id="loadingState" class="text-center py-12">
          <div
            class="inline-block animate-spin rounded-full h-12 w-12 border-4 border-primary border-t-transparent"
          ></div>
          <p class="mt-4 text-subtle-light dark:text-subtle-dark">
            Loading episode...
          </p>
        </div>

        <!-- Error State -->
        <div id="errorState" class="hidden text-center py-12">
          <p class="text-red-500 text-lg mb-4">Episode not found</p>
          <a
            href="talks-dynamic.html"
            class="inline-block bg-primary text-white font-bold px-6 py-3 rounded-lg hover:bg-primary/90 transition-colors"
          >
            Back to Episodes
          </a>
        </div>

        <!-- Episode Content -->
        <article id="episodeContent" class="max-w-6xl mx-auto hidden">
          <!-- Episode Header -->
          <div class="mb-8">
            <div class="flex items-center gap-4 mb-4">
              <span
                class="px-3 py-1 bg-primary/10 text-primary text-sm font-bold rounded-full uppercase tracking-wider"
              >
                Episode <span id="episodeNumber"></span>
              </span>
              <span class="text-subtle-light dark:text-subtle-dark text-sm">
                <span class="material-symbols-outlined text-lg align-middle">schedule</span>
                <span id="duration"></span> min
              </span>
            </div>
            <h1
              id="episodeTitle"
              class="text-4xl md:text-5xl font-extrabold tracking-tight mb-4"
            ></h1>
            <p
              id="episodeHeader"
              class="text-xl md:text-2xl text-subtle-light dark:text-subtle-dark mb-6"
            ></p>

            <div
              class="flex items-center gap-6 text-sm text-subtle-light dark:text-subtle-dark mb-8"
            >
              <div class="flex items-center gap-2">
                <span class="material-symbols-outlined text-lg">calendar_today</span>
                <span id="publishedDate"></span>
              </div>
            </div>
          </div>

          <!-- Video Player -->
          <div class="video-container mb-12">
            <iframe
              id="youtubePlayer"
              src=""
              frameborder="0"
              allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
              allowfullscreen
            ></iframe>
          </div>

          <!-- Episode Description -->
          <div class="prose prose-lg max-w-none mb-12">
            <h2>About This Episode</h2>
            <div id="episodeDescription"></div>
          </div>

          <!-- Key Takeaways -->
          <div class="mb-12 p-8 bg-green-50 dark:bg-green-900/20 rounded-xl border border-green-200 dark:border-green-800">
            <h3 class="text-2xl font-bold mb-6 flex items-center gap-2 text-green-800 dark:text-green-300">
              <span class="material-symbols-outlined text-3xl">lightbulb</span>
              Key Takeaways
            </h3>
            <ul id="keyTakeaways" class="space-y-3"></ul>
          </div>

          <!-- Speakers Panel -->
          <div class="mb-12">
            <h3 class="text-2xl font-bold mb-6">Meet the Speakers</h3>
            <div id="speakerPanels" class="grid md:grid-cols-2 gap-6"></div>
          </div>

          <!-- Comments Section -->
          <div class="mb-12 p-8 bg-white dark:bg-gray-800 rounded-xl border border-subtle-light/20 dark:border-subtle-dark/20">
            <div id="comments-container"></div>
          </div>

          <!-- Back to Episodes -->
          <div class="mt-12 pt-8 border-t border-subtle-light/20 dark:border-subtle-dark/20">
            <a
              href="talks-dynamic.html"
              class="inline-flex items-center gap-2 text-primary hover:text-primary/80 font-medium transition-colors"
            >
              <span class="material-symbols-outlined">arrow_back</span>
              <span>Back to All Episodes</span>
            </a>
          </div>
        </article>
      </main>

      <footer
        class="bg-background-light dark:bg-background-dark border-t border-subtle-light/20 dark:border-subtle-dark/20"
      >
        <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-8">
          <div
            class="flex flex-col md:flex-row justify-between items-center gap-6"
          >
            <div class="flex items-center gap-2 text-primary">
              <svg
                class="h-6 w-6"
                fill="none"
                viewBox="0 0 48 48"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M4 42.4379C4 42.4379 14.0962 36.0744 24 41.1692C35.0664 46.8624 44 42.2078 44 42.2078L44 7.01134C44 7.01134 35.068 11.6577 24.0031 5.96913C14.0971 0.876274 4 7.27094 4 7.27094L4 42.4379Z"
                  fill="currentColor"
                ></path>
              </svg>
              <h2 class="text-lg font-bold">NeoSharX</h2>
            </div>
            <div
              class="flex flex-wrap items-center justify-center gap-x-6 gap-y-2"
            >
              <a
                class="text-sm text-subtle-light dark:text-subtle-dark hover:text-primary transition-colors"
                href="#"
                >About</a
              >
              <a
                class="text-sm text-subtle-light dark:text-subtle-dark hover:text-primary transition-colors"
                href="#"
                >Contact</a
              >
              <a
                class="text-sm text-subtle-light dark:text-subtle-dark hover:text-primary transition-colors"
                href="#"
                >Terms of Service</a
              >
              <a
                class="text-sm text-subtle-light dark:text-subtle-dark hover:text-primary transition-colors"
                href="#"
                >Privacy Policy</a
              >
            </div>
            <p class="text-sm text-subtle-light dark:text-subtle-dark">
              Â© 2023 NeoSharX. All rights reserved.
            </p>
          </div>
        </div>
      </footer>
    </div>

    <script src="comment-system.js"></script>
    <script>
      const API_BASE_URL = "http://localhost:8001/api/auth";

      // Get slug from URL
      const urlParams = new URLSearchParams(window.location.search);
      const slug = urlParams.get("slug");

      async function loadEpisode() {
        const loadingState = document.getElementById("loadingState");
        const errorState = document.getElementById("errorState");
        const episodeContent = document.getElementById("episodeContent");

        if (!slug) {
          console.error("No slug provided in URL");
          loadingState.classList.add("hidden");
          errorState.classList.remove("hidden");
          return;
        }

        try {
          console.log("Fetching episode with slug:", slug);
          const response = await fetch(`${API_BASE_URL}/talk-episodes/${slug}/`);

          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }

          const episode = await response.json();
          console.log("Episode data loaded:", episode);

          loadingState.classList.add("hidden");
          episodeContent.classList.remove("hidden");
          renderEpisode(episode);
          
          // Initialize comment system
          initializeCommentSystem(slug);
        } catch (error) {
          console.error("Error loading episode:", error);
          loadingState.classList.add("hidden");
          errorState.classList.remove("hidden");
        }
      }

      function renderEpisode(episode) {
        // Update page title
        document.title = `${episode.title} - NeoSharX Talks`;

        // Episode Number & Duration
        document.getElementById("episodeNumber").textContent = episode.episode_number;
        document.getElementById("duration").textContent = episode.duration_minutes;

        // Title & Header
        document.getElementById("episodeTitle").textContent = episode.title;
        document.getElementById("episodeHeader").textContent = episode.header;

        // Published Date
        const publishedDate = episode.published_at
          ? new Date(episode.published_at).toLocaleDateString("en-US", {
              year: "numeric",
              month: "long",
              day: "numeric",
            })
          : "Recently published";
        document.getElementById("publishedDate").textContent = publishedDate;

        // YouTube Video
        const youtubePlayer = document.getElementById("youtubePlayer");
        youtubePlayer.src = episode.youtube_embed_url || episode.youtube_url;

        // Description
        const descriptionDiv = document.getElementById("episodeDescription");
        const paragraphs = episode.description.split("\n\n");
        descriptionDiv.innerHTML = paragraphs
          .map((p) => (p.trim() ? `<p>${p.trim()}</p>` : ""))
          .join("");

        // Key Takeaways
        const takeawaysUl = document.getElementById("keyTakeaways");
        if (episode.key_takeaways && episode.key_takeaways.length > 0) {
          takeawaysUl.innerHTML = episode.key_takeaways
            .map(
              (takeaway) =>
                `<li class="flex items-start gap-3">
                  <span class="material-symbols-outlined text-green-600 dark:text-green-400 mt-1">check_circle</span>
                  <span class="text-lg">${takeaway}</span>
                </li>`
            )
            .join("");
        }

        // Speaker Panels
        const speakersDiv = document.getElementById("speakerPanels");
        if (episode.speaker_panels && episode.speaker_panels.length > 0) {
          speakersDiv.innerHTML = episode.speaker_panels
            .map(
              (speaker) => `
                <div class="p-6 bg-background-light dark:bg-background-dark rounded-xl border border-subtle-light/20 dark:border-subtle-dark/20">
                  <div class="flex items-start gap-4">
                    <img
                      src="${speaker.avatar_url}"
                      alt="${speaker.name}"
                      class="w-16 h-16 rounded-full border-2 border-primary/20"
                    />
                    <div class="flex-grow">
                      <h4 class="text-xl font-bold mb-1">${speaker.name}</h4>
                      <p class="text-primary text-sm font-medium mb-2">${speaker.title}</p>
                      <p class="text-subtle-light dark:text-subtle-dark text-sm mb-3">${speaker.bio}</p>
                      ${
                        speaker.social_links
                          ? `<div class="flex gap-3">
                              ${
                                speaker.social_links.linkedin
                                  ? `<a href="${speaker.social_links.linkedin}" target="_blank" class="text-primary hover:text-primary/80 transition-colors">
                                      <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-11 19h-3v-11h3v11zm-1.5-12.268c-.966 0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zm13.5 12.268h-3v-5.604c0-3.368-4-3.113-4 0v5.604h-3v-11h3v1.765c1.396-2.586 7-2.777 7 2.476v6.759z"/></svg>
                                    </a>`
                                  : ""
                              }
                              ${
                                speaker.social_links.twitter
                                  ? `<a href="${speaker.social_links.twitter}" target="_blank" class="text-primary hover:text-primary/80 transition-colors">
                                      <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M24 4.557c-.883.392-1.832.656-2.828.775 1.017-.609 1.798-1.574 2.165-2.724-.951.564-2.005.974-3.127 1.195-.897-.957-2.178-1.555-3.594-1.555-3.179 0-5.515 2.966-4.797 6.045-4.091-.205-7.719-2.165-10.148-5.144-1.29 2.213-.669 5.108 1.523 6.574-.806-.026-1.566-.247-2.229-.616-.054 2.281 1.581 4.415 3.949 4.89-.693.188-1.452.232-2.224.084.626 1.956 2.444 3.379 4.6 3.419-2.07 1.623-4.678 2.348-7.29 2.04 2.179 1.397 4.768 2.212 7.548 2.212 9.142 0 14.307-7.721 13.995-14.646.962-.695 1.797-1.562 2.457-2.549z"/></svg>
                                    </a>`
                                  : ""
                              }
                            </div>`
                          : ""
                      }
                    </div>
                  </div>
                </div>
              `
            )
            .join("");
        }
      }

      function initializeCommentSystem(slug) {
        // Initialize comment system for talk episodes
        const commentSystem = new CommentSystem(
          'talk_episode',
          slug,
          'comments-container',
          {
            apiBaseUrl: 'http://localhost:8001/api/auth',
            showLoginPrompt: true,
            enableReplies: true,
            enableLikes: true,
          }
        );
      }

      // Load navigation
      fetch("navigation.html")
        .then((res) => res.text())
        .then((html) => {
          document.getElementById("nav-container").innerHTML = html;
        })
        .catch((err) => console.error("Navigation load error:", err));

      // Load episode on page load
      document.addEventListener("DOMContentLoaded", loadEpisode);
    </script>
  </body>
</html>
