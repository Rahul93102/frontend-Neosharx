<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>API Connection Test</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 1200px;
        margin: 20px auto;
        padding: 20px;
        background: #f5f5f5;
      }
      .test-section {
        background: white;
        padding: 20px;
        margin: 20px 0;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }
      .status {
        padding: 10px;
        margin: 10px 0;
        border-radius: 4px;
      }
      .success {
        background: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
      }
      .error {
        background: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
      }
      .loading {
        background: #fff3cd;
        color: #856404;
        border: 1px solid #ffeaa7;
      }
      pre {
        background: #f8f9fa;
        padding: 15px;
        border-radius: 4px;
        overflow-x: auto;
        max-height: 400px;
      }
      button {
        background: #007fff;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 4px;
        cursor: pointer;
        font-size: 16px;
        margin: 5px;
      }
      button:hover {
        background: #0066cc;
      }
      h2 {
        color: #007fff;
      }
    </style>
  </head>
  <body>
    <h1>üîç NeoSharX API Connection Test</h1>
    <p>This page tests the connection between frontend and backend APIs.</p>

    <!-- Events Test -->
    <div class="test-section">
      <h2>üìÖ Events API Test</h2>
      <button onclick="testEventsAPI()">Test Events API</button>
      <div id="events-status"></div>
      <pre id="events-data"></pre>
    </div>

    <!-- YouTube Videos Test -->
    <div class="test-section">
      <h2>üé• YouTube Videos API Test</h2>
      <button onclick="testYouTubeAPI()">Test YouTube Videos API</button>
      <div id="youtube-status"></div>
      <pre id="youtube-data"></pre>
    </div>

    <!-- Network Test -->
    <div class="test-section">
      <h2>üåê Network Test</h2>
      <button onclick="testConnection()">Test Backend Connection</button>
      <div id="connection-status"></div>
    </div>

    <script>
      const API_BASE_URL = "http://127.0.0.1:8000/api/auth";

      function showStatus(elementId, message, type) {
        const element = document.getElementById(elementId);
        element.innerHTML = `<div class="status ${type}">${message}</div>`;
      }

      function showData(elementId, data) {
        const element = document.getElementById(elementId);
        element.textContent = JSON.stringify(data, null, 2);
      }

      async function testConnection() {
        showStatus("connection-status", "‚è≥ Testing connection...", "loading");

        try {
          const response = await fetch(`${API_BASE_URL}/events/`);

          if (response.ok) {
            showStatus(
              "connection-status",
              `‚úÖ Backend is online! Status: ${response.status} ${response.statusText}`,
              "success"
            );
          } else {
            showStatus(
              "connection-status",
              `‚ö†Ô∏è Backend responded with status: ${response.status} ${response.statusText}`,
              "error"
            );
          }
        } catch (error) {
          showStatus(
            "connection-status",
            `‚ùå Cannot connect to backend: ${error.message}`,
            "error"
          );
        }
      }

      async function testEventsAPI() {
        showStatus("events-status", "‚è≥ Fetching events...", "loading");
        showData("events-data", "Loading...");

        try {
          // Test all three event types
          const [pastRes, recentRes, upcomingRes] = await Promise.all([
            fetch(`${API_BASE_URL}/events/type/past/`),
            fetch(`${API_BASE_URL}/events/type/recent/`),
            fetch(`${API_BASE_URL}/events/type/upcoming/`),
          ]);

          const pastData = await pastRes.json();
          const recentData = await recentRes.json();
          const upcomingData = await upcomingRes.json();

          const summary = {
            past: {
              count: pastData.count || 0,
              events: pastData.results?.length || 0,
              first: pastData.results?.[0]?.name || "None",
            },
            recent: {
              count: recentData.count || 0,
              events: recentData.results?.length || 0,
              first: recentData.results?.[0]?.name || "None",
            },
            upcoming: {
              count: upcomingData.count || 0,
              events: upcomingData.results?.length || 0,
              first: upcomingData.results?.[0]?.name || "None",
            },
            fullData: {
              past: pastData,
              recent: recentData,
              upcoming: upcomingData,
            },
          };

          showStatus(
            "events-status",
            `‚úÖ Events loaded! Past: ${summary.past.count}, Recent: ${summary.recent.count}, Upcoming: ${summary.upcoming.count}`,
            "success"
          );
          showData("events-data", summary);
        } catch (error) {
          showStatus(
            "events-status",
            `‚ùå Error fetching events: ${error.message}`,
            "error"
          );
          showData("events-data", { error: error.message, stack: error.stack });
        }
      }

      async function testYouTubeAPI() {
        showStatus("youtube-status", "‚è≥ Fetching videos...", "loading");
        showData("youtube-data", "Loading...");

        try {
          const response = await fetch(`${API_BASE_URL}/youtube-videos/`);
          const data = await response.json();

          const summary = {
            count: data.count || 0,
            videos: data.videos?.length || 0,
            types: {},
            first: data.videos?.[0] || null,
            fullData: data,
          };

          // Count by type
          data.videos?.forEach((video) => {
            summary.types[video.video_type] =
              (summary.types[video.video_type] || 0) + 1;
          });

          showStatus(
            "youtube-status",
            `‚úÖ Videos loaded! Total: ${summary.count}, Videos: ${
              summary.types.video || 0
            }, Shorts: ${summary.types.short || 0}`,
            "success"
          );
          showData("youtube-data", summary);
        } catch (error) {
          showStatus(
            "youtube-status",
            `‚ùå Error fetching videos: ${error.message}`,
            "error"
          );
          showData("youtube-data", {
            error: error.message,
            stack: error.stack,
          });
        }
      }

      // Auto-test on page load
      window.addEventListener("load", () => {
        console.log("Running automatic tests...");
        testConnection();
        setTimeout(() => testEventsAPI(), 500);
        setTimeout(() => testYouTubeAPI(), 1000);
      });
    </script>
  </body>
</html>
