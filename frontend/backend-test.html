<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Backend Integration Test</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
        background: #f5f5f5;
      }
      h1 {
        color: #007fff;
        text-align: center;
      }
      .section {
        background: white;
        padding: 20px;
        margin: 20px 0;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }
      .status {
        padding: 10px;
        margin: 10px 0;
        border-radius: 4px;
      }
      .success {
        background: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
      }
      .error {
        background: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
      }
      .loading {
        background: #d1ecf1;
        color: #0c5460;
        border: 1px solid #bee5eb;
      }
      pre {
        background: #f8f9fa;
        padding: 10px;
        border-radius: 4px;
        overflow-x: auto;
      }
      button {
        background: #007fff;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 4px;
        cursor: pointer;
        margin: 5px;
      }
      button:hover {
        background: #0066cc;
      }
    </style>
  </head>
  <body>
    <h1>üöÄ NeoSharX Backend Integration Test</h1>

    <div class="section">
      <h2>API Configuration</h2>
      <p>
        <strong>Base URL:</strong>
        <code id="api-url">http://127.0.0.1:8000/api/auth</code>
      </p>
      <button onclick="testConnection()">Test Connection</button>
      <div id="connection-status"></div>
    </div>

    <div class="section">
      <h2>üìÖ Events API</h2>
      <button onclick="testEventsAPI()">Test Events API</button>
      <div id="events-status"></div>
      <pre id="events-data"></pre>
    </div>

    <div class="section">
      <h2>üé¨ YouTube Videos API</h2>
      <button onclick="testVideosAPI()">Test Videos API</button>
      <div id="videos-status"></div>
      <pre id="videos-data"></pre>
    </div>

    <div class="section">
      <h2>üìä Summary</h2>
      <div id="summary"></div>
    </div>

    <script>
      const API_BASE_URL = "http://127.0.0.1:8000/api/auth";
      let testResults = {
        connection: null,
        events: null,
        videos: null,
      };

      async function testConnection() {
        const statusDiv = document.getElementById("connection-status");
        statusDiv.innerHTML =
          '<div class="loading">‚è≥ Testing connection...</div>';

        try {
          const response = await fetch(`${API_BASE_URL}/events/`);
          if (response.ok) {
            testResults.connection = true;
            statusDiv.innerHTML =
              '<div class="success">‚úÖ Connection successful! Backend is reachable.</div>';
          } else {
            testResults.connection = false;
            statusDiv.innerHTML = `<div class="error">‚ùå Connection failed with status: ${response.status}</div>`;
          }
        } catch (error) {
          testResults.connection = false;
          statusDiv.innerHTML = `<div class="error">‚ùå Connection error: ${error.message}</div>`;
        }
        updateSummary();
      }

      async function testEventsAPI() {
        const statusDiv = document.getElementById("events-status");
        const dataDiv = document.getElementById("events-data");
        statusDiv.innerHTML =
          '<div class="loading">‚è≥ Fetching events...</div>';

        try {
          const [allRes, pastRes, recentRes, upcomingRes, featuredRes] =
            await Promise.all([
              fetch(`${API_BASE_URL}/events/`),
              fetch(`${API_BASE_URL}/events/type/past/`),
              fetch(`${API_BASE_URL}/events/type/recent/`),
              fetch(`${API_BASE_URL}/events/type/upcoming/`),
              fetch(`${API_BASE_URL}/events/featured/`),
            ]);

          const allEvents = await allRes.json();
          const pastEvents = await pastRes.json();
          const recentEvents = await recentRes.json();
          const upcomingEvents = await upcomingRes.json();
          const featuredEvents = await featuredRes.json();

          testResults.events = true;

          const summary = {
            "Total Events": allEvents.count || allEvents.length,
            "Past Events": pastEvents.length,
            "Recent Events": recentEvents.length,
            "Upcoming Events": upcomingEvents.length,
            "Featured Events": featuredEvents.length,
          };

          statusDiv.innerHTML =
            '<div class="success">‚úÖ Events API working! All endpoints responding correctly.</div>';
          dataDiv.textContent = JSON.stringify(summary, null, 2);
        } catch (error) {
          testResults.events = false;
          statusDiv.innerHTML = `<div class="error">‚ùå Error: ${error.message}</div>`;
          dataDiv.textContent = "";
        }
        updateSummary();
      }

      async function testVideosAPI() {
        const statusDiv = document.getElementById("videos-status");
        const dataDiv = document.getElementById("videos-data");
        statusDiv.innerHTML =
          '<div class="loading">‚è≥ Fetching videos...</div>';

        try {
          const [allRes, featuredRes, videosRes, shortsRes] = await Promise.all(
            [
              fetch(`${API_BASE_URL}/youtube-videos/`),
              fetch(`${API_BASE_URL}/youtube-videos/featured/`),
              fetch(`${API_BASE_URL}/youtube-videos/type/video/`),
              fetch(`${API_BASE_URL}/youtube-videos/type/short/`),
            ]
          );

          const allVideos = await allRes.json();
          const featuredVideos = await featuredRes.json();
          const videos = await videosRes.json();
          const shorts = await shortsRes.json();

          testResults.videos = true;

          const summary = {
            "Total Videos": allVideos.count || allVideos.videos?.length || 0,
            "Featured Videos": featuredVideos.videos?.length || 0,
            "YouTube Videos": videos.videos?.length || 0,
            "YouTube Shorts": shorts.videos?.length || 0,
            "Sample Video": allVideos.videos?.[0]
              ? {
                  title: allVideos.videos[0].title,
                  type: allVideos.videos[0].video_type,
                  autoplay: allVideos.videos[0].autoplay,
                  embed_url: allVideos.videos[0].embed_url,
                }
              : "No videos",
          };

          statusDiv.innerHTML =
            '<div class="success">‚úÖ Videos API working! All endpoints responding correctly.</div>';
          dataDiv.textContent = JSON.stringify(summary, null, 2);
        } catch (error) {
          testResults.videos = false;
          statusDiv.innerHTML = `<div class="error">‚ùå Error: ${error.message}</div>`;
          dataDiv.textContent = "";
        }
        updateSummary();
      }

      function updateSummary() {
        const summaryDiv = document.getElementById("summary");
        const total = Object.values(testResults).filter(
          (v) => v !== null
        ).length;
        const passed = Object.values(testResults).filter(
          (v) => v === true
        ).length;
        const failed = Object.values(testResults).filter(
          (v) => v === false
        ).length;

        if (total === 0) {
          summaryDiv.innerHTML = "<p>Run tests to see results...</p>";
          return;
        }

        const allPassed = failed === 0 && total === 3;
        const statusClass = allPassed
          ? "success"
          : failed > 0
          ? "error"
          : "loading";
        const statusIcon = allPassed ? "‚úÖ" : failed > 0 ? "‚ùå" : "‚è≥";

        summaryDiv.innerHTML = `
                <div class="${statusClass}">
                    <h3>${statusIcon} Test Results</h3>
                    <p><strong>Total Tests:</strong> ${total}/3</p>
                    <p><strong>Passed:</strong> ${passed}</p>
                    <p><strong>Failed:</strong> ${failed}</p>
                    ${
                      allPassed
                        ? "<p><strong>üéâ All tests passed! Backend integration is working perfectly.</strong></p>"
                        : ""
                    }
                </div>
            `;
      }

      // Auto-run tests on page load
      window.addEventListener("DOMContentLoaded", () => {
        setTimeout(() => {
          testConnection();
          setTimeout(() => testEventsAPI(), 500);
          setTimeout(() => testVideosAPI(), 1000);
        }, 500);
      });
    </script>
  </body>
</html>
